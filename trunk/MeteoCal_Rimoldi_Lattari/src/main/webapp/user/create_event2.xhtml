<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Meteocal</title>
<link href="../css/create_event.css" rel="stylesheet" type="text/css" />
<script src="http://maps.google.com/maps/api/js?sensor=false" 
          type="text/javascript"></script>
<!--<script src=" http://code.jquery.com/jquery-1.6.4.min.js" type="text/javascript"></script>-->
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
    var currentMarker = null;
    function GetLocation() {
        var geocoder = new google.maps.Geocoder();
        var address = $('[id="#{p:component('address')}"]').val();
        geocoder.geocode({ 'address': address }, function (results, status) {
            if (status === google.maps.GeocoderStatus.OK) {
                var latitude = results[0].geometry.location.lat();
                var longitude = results[0].geometry.location.lng();
                $('[id="#{p:component('latitude')}"]').val(latitude);
                $('[id="#{p:component('longitude')}"]').val(longitude);
                if(currentMarker === null){
                    currentMarker = new google.maps.Marker({
                            position:new google.maps.LatLng(latitude,longitude)
                    });
                    PF('map').addOverlay(currentMarker);
                } else {
                    currentMarker = new google.maps.Marker({
                            position:new google.maps.LatLng(latitude,longitude)
                });
                
                PF('map').addOverlay(currentMarker);
                }
                alert("Latitude: " + latitude + "\nLongitude: " + longitude);
            } else {
                alert("Request failed.");
            }
        });
    };
</script>
</h:head>

<h:body style="background-color:#81a4c7">
	<div id="wrap">
    	<div id="header">
            <a href="user_home3.xhtml"><img src="./../images/Logo.png" style="width:150px; height:150px;" /></a>
            <div id="welcome_txt" style="float:right; margin-top:90px;">
            	<h1>Welcome to Meteocal!</h1>
            </div>
        </div>
        <div id="central">
            <div id="event_area">
                <div id="event_container">
                    <div id="event_header">
                        <h1>New event</h1>
                    </div>
                    <h:form id="eventform" style="font-family: Comic Sans MS; color: #ffffff; font-size: 20px; margin-left: 20px;"  >
                        <h:panelGrid columns="1" id="evGrid">
                            <h:outputLabel for="name">Name:</h:outputLabel>
                            <p:inputText id="name" value="#{eb.event.name}" style="width: 350px;">
                                <p:ajax update="namemsg"/>
                            </p:inputText>
                            <p:message id="namemsg" for="name" />

                            <h:outputLabel for="description">Description:</h:outputLabel>
                            <p:inputTextarea id="description" value="#{eb.event.description}" style="min-width:350px; max-width: 350px;
                                                        min-height: 150px; max-height: 150px;" autoResize="false"/>

                            <h:outputLabel for="starttime">Start time:</h:outputLabel>
                            <p:calendar id="starttime" value="#{eb.event.starttime}" pattern="MM/dd/yyyy HH:mm" stepMinute="15" style="width: 350px;" />

                            <h:outputLabel for="endtime">End time:</h:outputLabel>
                            <p:calendar id="endtime" value="#{eb.event.endtime}" pattern="MM/dd/yyyy HH:mm" stepMinute="15" style="width: 350px;" />

                            <h:outputLabel for="address">Location:</h:outputLabel>                            
                            <p:inputText id="address" value="#{eb.event.place}" style="width: 350px;" >
                                <p:ajax  event="blur" update=":eventform:forecast" listener="#{wb.retrieveConditions()}" />
                            </p:inputText>
                            <p:message id="placemsg" for="address" />
                            <input type="button" onclick="GetLocation()" value="Confirm location" style="width: 358px; margin-top: 10px; margin-bottom: 10px; border:0; box-shadow:0px 2px 5px #000000; 
                                             float: left; background: #6cb364; color: white; font-size: 20px; font-family: Comic Sans MS;"/>
                            <h:outputLabel for="latitude">Latitude</h:outputLabel>
                            <p:inputText id="latitude" disabled="true" value="#{wb.lat}"></p:inputText>
                            <h:outputLabel for="latitude">Longitude</h:outputLabel>
                            <p:inputText id="longitude" disabled="true" value="#{wb.lon}">
                                <p:ajax event="change" update=":eventform:forecast" listener="#{wb.retrieveConditions()}"/>
                                
                            </p:inputText>
                                <h:inputText id="forecast" value="#{weatherBean.conditions}" />
                            <h:form style="margin-top: 10px;"> 
                                <p:growl id="messages" showDetail="true" life="2000" />
                                <p:gmap id="gmap" widgetVar="map" center="41.381542, 2.122893" zoom="15" type="ROADMAP" style="width:358px; height:200px">
                                    <p:ajax event="stateChange" listener="#{eventView.onStateChange}" update="messages" />
                                    <p:ajax event="pointSelect" listener="#{eventView.onPointSelect}" update="messages" />
                                </p:gmap>
                            </h:form>
                            <p:outputLabel for="privacy" value="Event privacy:" />
                            <p:selectOneRadio id="privacy" value="#{eb.event.private1}" style="width: 350px;">
                                <f:selectItem itemLabel="Private" itemValue="#{true}" />
                                <f:selectItem itemLabel="Public" itemValue="#{false}" />
                            </p:selectOneRadio>
                            <br />
                            <p:outputLabel for="indoor" value="Event location type:" />
                            <p:selectOneRadio id="indoor" value="#{eb.event.indoor}" style="width: 350px;">
                                <f:selectItem itemLabel="Indoor" itemValue="#{true}" />
                                <f:selectItem itemLabel="Outdoor" itemValue="#{false}" />
                            </p:selectOneRadio>
                            
                            <p:commandButton value="Invite" type="button" onclick="PF('listDialog').show();" style="width: 358px; margin-top: 10px; border:0; box-shadow:0px 2px 5px #000000; 
                                             float: left; background: #6cb364; color: white; font-family: Comic Sans MS;"/>
                            
                            <p:commandButton id="submit" value="Create" update="evGrid" style="width: 358px; margin-top: 10px; border:0; box-shadow:0px 2px 5px #000000; 
                                             float: left; background: #6cb364; color: white; font-family: Comic Sans MS;"
                                             action="#{eb.createEvent(ub.currentUser)}"/>
                            <br />
                        </h:panelGrid>
                        
                        <p:dialog widgetVar="listDialog" showEffect="clip" hideEffect="clip" resizable="false" style="width: 840px;" >
                    <div id="list_container">
                    <div id="list_header">
                    <h1>Users list</h1>
                    </div>
                    <h:panelGrid id="listDetails" columns="2" style="text-align: left;">
                    <h:form id="form"> 
                    <p:panel id="panel" header="Insert a keyword (name, surname, email or phone)" style="margin-bottom:10px;">
                    <p:messages id="messages" />

                    <h:panelGrid columns="4" cellpadding="5">
                    <h:outputLabel for="txt1" value="Keyword: *" />
                    <p:inputText id="txt1" value="#{searchBean.parameter}" required="true" label="Text 1">
                    <f:validateLength minimum="2" />
                    </p:inputText>

                    </h:panelGrid>
                    </p:panel>

                    <h:panelGrid columns="1">
                    <p:commandButton process="@form:@child(1):txt1" update="@form" value="Search"/>
                    </h:panelGrid>

                    <p:dataList value="#{searchBean.searchUsers(searchBean.parameter)}" var="user" type="unordered" itemType="none" paginator="true" rows="10" styleClass="paginated">
                    <f:facet name="header">
                    Result list (click to invite)
                    </f:facet>
                        <p:commandLink  oncomplete="PF('messageDialog').show()" title="Invite" styleClass="ui-icon ui-icon-plusthick" style="float:left;margin-right:10px">
                            <f:setPropertyActionListener value="#{user}" target="#{searchBean.selectedUser}" />
                            <h:outputText value="#{user.name} #{user.surname}, #{user.email}" />
                        </p:commandLink>
                    <h:outputText value="#{user.name} #{user.surname}, #{user.email}" style="display:inline-block"/>
                    </p:dataList>
                        
                        
                        <p:dialog onShow="#{eventBean.addGuest(user)}" header="Confirmation" widgetVar="messageDialog" modal="true" showEffect="blind" hideEffect="explode" resizable="false">
                            <p:outputPanel id="message2" style="text-align:center;">
                                <h:outputText value="Aggiunto"/>
                            </p:outputPanel>
                        </p:dialog>
                        
                        
                    </h:form>
                    </h:panelGrid>
                    </div>
                    <h:form id="modifyForm" style="margin-top: 10px;">
                    <p:commandButton value="Modify event" action="#{scheduleView.resultUrl()}" style=" border:0; box-shadow:0px 2px 5px #000000; 
                    float: left; margin-left: 10px; margin-top: 10px; background: #6cb364; color: white; font-family: Comic Sans MS;" />
                    </h:form>
                    </p:dialog>
                        
                    </h:form>
                </div>
            </div>
            <div id="info">
                <div id="meteo_info">
                    <h1>Wheather forecast</h1>
                    
                </div>
            </div>
        </div>
        <div id="footer">
            <p>Software engineering 2</p>
            Project 2014-2015<br />
            Rimoldi_Lattari<br />
            <p></p>
        </div>
    </div>
</h:body>
</html>

